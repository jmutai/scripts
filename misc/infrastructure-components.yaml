apiVersion: v1
kind: Namespace
metadata:
  labels:
    app.kubernetes.io/component: manager
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: system
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: namespace
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/provider: infrastructure-proxmox
    control-plane: cappx-controller-manager
  name: cappx-system
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.1
  labels:
    cluster.x-k8s.io/provider: infrastructure-proxmox
    cluster.x-k8s.io/v1beta1: v1beta1
  name: proxmoxclusters.infrastructure.cluster.x-k8s.io
spec:
  group: infrastructure.cluster.x-k8s.io
  names:
    kind: ProxmoxCluster
    listKind: ProxmoxClusterList
    plural: proxmoxclusters
    singular: proxmoxcluster
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Cluster infrastructure is ready for ProxmoxMachine
      jsonPath: .status.ready
      name: Ready
      type: string
    - description: Server is the address of the Proxmox API endpoint.
      jsonPath: .spec.serverRef.endpoint
      name: Proxmox-Server
      type: string
    - description: kube-apiserver Endpoint
      jsonPath: .spec.controlPlaneEndpoint.host
      name: ControlPlane
      type: string
    - description: Time duration since creation of Machine
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: ProxmoxCluster is the Schema for the proxmoxclusters API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ProxmoxClusterSpec defines the desired state of ProxmoxCluster
            properties:
              controlPlaneEndpoint:
                description: ControlPlaneEndpoint represents the endpoint used to
                  communicate with the control plane.
                properties:
                  host:
                    description: The hostname on which the API server is serving.
                    type: string
                  port:
                    description: The port on which the API server is serving.
                    format: int32
                    type: integer
                required:
                - host
                - port
                type: object
              serverRef:
                description: ServerRef is used for configuring Proxmox client
                properties:
                  endpoint:
                    description: endpoint is the address of the Proxmox-VE REST API
                      endpoint.
                    type: string
                  secretRef:
                    description: SecretRef is a reference for secret which contains
                      proxmox login secrets
                    properties:
                      name:
                        description: |-
                          Name of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                        type: string
                      namespace:
                        description: |-
                          Namespace of the referent.
                          More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/
                        type: string
                    required:
                    - name
                    type: object
                required:
                - endpoint
                - secretRef
                type: object
              storage:
                description: storage is used for storing cloud init snippet
                properties:
                  name:
                    type: string
                  path:
                    type: string
                type: object
            required:
            - serverRef
            type: object
          status:
            description: ProxmoxClusterStatus defines the observed state of ProxmoxCluster
            properties:
              conditions:
                description: Conditions
                items:
                  description: Condition defines an observation of a Cluster API resource
                    operational state.
                  properties:
                    lastTransitionTime:
                      description: |-
                        Last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed. If that is not known, then using the time when
                        the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        A human readable message indicating details about the transition.
                        This field may be empty.
                      type: string
                    reason:
                      description: |-
                        The reason for the condition's last transition in CamelCase.
                        The specific API may choose whether or not this field is considered a guaranteed API.
                        This field may not be empty.
                      type: string
                    severity:
                      description: |-
                        Severity provides an explicit classification of Reason code, so the users or machines can immediately
                        understand the current situation and act accordingly.
                        The Severity field MUST be set only when Status=False.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: |-
                        Type of condition in CamelCase or in foo.example.com/CamelCase.
                        Many .condition.type values are consistent across resources like Available, but because arbitrary conditions
                        can be useful (see .node.status.conditions), the ability to deconflict is important.
                      type: string
                  required:
                  - lastTransitionTime
                  - status
                  - type
                  type: object
                type: array
              failureDomains:
                additionalProperties:
                  description: |-
                    FailureDomainSpec is the Schema for Cluster API failure domains.
                    It allows controllers to understand how many failure domains a cluster can optionally span across.
                  properties:
                    attributes:
                      additionalProperties:
                        type: string
                      description: Attributes is a free form map of attributes an
                        infrastructure provider might use or require.
                      type: object
                    controlPlane:
                      description: ControlPlane determines if this failure domain
                        is suitable for use by control plane machines.
                      type: boolean
                  type: object
                description: FailureDomains
                type: object
              ready:
                description: Ready
                type: boolean
            required:
            - ready
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.1
  labels:
    cluster.x-k8s.io/provider: infrastructure-proxmox
    cluster.x-k8s.io/v1beta1: v1beta1
  name: proxmoxmachines.infrastructure.cluster.x-k8s.io
spec:
  group: infrastructure.cluster.x-k8s.io
  names:
    kind: ProxmoxMachine
    listKind: ProxmoxMachineList
    plural: proxmoxmachines
    singular: proxmoxmachine
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Cluster to which this VSphereMachine belongs
      jsonPath: .metadata.labels.cluster\.x-k8s\.io/cluster-name
      name: Cluster
      type: string
    - description: Machine object which owns with this ProxmoxMachine
      jsonPath: .metadata.ownerReferences[?(@.kind=="Machine")].name
      name: Machine
      priority: 1
      type: string
    - jsonPath: .spec.vmID
      name: VMID
      priority: 1
      type: string
    - jsonPath: .spec.node
      name: Node
      priority: 1
      type: string
    - jsonPath: .spec.storage
      name: Storage
      priority: 1
      type: string
    - jsonPath: .spec.providerID
      name: ProviderID
      type: string
    - jsonPath: .status.instanceStatus
      name: Status
      type: string
    - description: Time duration since creation of Machine
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1beta1
    schema:
      openAPIV3Schema:
        description: ProxmoxMachine is the Schema for the proxmoxmachines API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ProxmoxMachineSpec defines the desired state of ProxmoxMachine
            properties:
              cloudInit:
                description: |-
                  CloudInit defines options related to the bootstrapping systems where
                  CloudInit is used.
                properties:
                  user:
                    properties:
                      bootcmd:
                        items:
                          type: string
                        type: array
                      ca_certs:
                        properties:
                          remove_defaults:
                            type: boolean
                          trusted:
                            items:
                              type: string
                            type: array
                        type: object
                      chpasswd:
                        properties:
                          expire:
                            type: string
                        type: object
                      manage_etc_hosts:
                        type: boolean
                      no_ssh_fingerprints:
                        type: boolean
                      package_update:
                        type: boolean
                      package_upgrade:
                        type: boolean
                      packages:
                        items:
                          type: string
                        type: array
                      password:
                        type: string
                      runCmd:
                        items:
                          type: string
                        type: array
                      ssh:
                        properties:
                          emit_keys_to_console:
                            type: boolean
                        type: object
                      ssh_authorized_keys:
                        items:
                          type: string
                        type: array
                      ssh_keys:
                        properties:
                          dsa_private:
                            type: string
                          dsa_public:
                            type: string
                          ecdsa_private:
                            type: string
                          ecdsa_public:
                            type: string
                          rsa_private:
                            type: string
                          rsa_public:
                            type: string
                        type: object
                      ssh_pwauth:
                        type: boolean
                      user:
                        type: string
                      users:
                        items:
                          properties:
                            expiredate:
                              pattern: ^/d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$
                              type: string
                            gecos:
                              type: string
                            groups:
                              items:
                                type: string
                              type: array
                            homedir:
                              pattern: ^/.+
                              type: string
                            inactive:
                              minimum: 0
                              type: integer
                            lock_passwd:
                              type: boolean
                            name:
                              type: string
                            no_create_home:
                              type: boolean
                            no_log_init:
                              type: boolean
                            no_user_group:
                              type: boolean
                            passwd:
                              type: string
                            primary_group:
                              type: string
                            selinux_user:
                              type: string
                            shell:
                              type: string
                            snapuser:
                              type: string
                            ssh_authorized_keys:
                              items:
                                type: string
                              type: array
                            ssh_import_id:
                              items:
                                type: string
                              type: array
                            ssh_redirect_user:
                              type: boolean
                            sudo:
                              items:
                                type: string
                              type: array
                            system:
                              type: boolean
                          required:
                          - name
                          type: object
                        type: array
                      writeFiles:
                        items:
                          properties:
                            content:
                              type: string
                            defer:
                              type: boolean
                            encoding:
                              type: string
                            owner:
                              type: string
                            path:
                              type: string
                            permissions:
                              type: string
                          type: object
                        type: array
                    type: object
                type: object
              failureDomain:
                description: FailureDomain is the failure domain unique identifier
                  this Machine should be attached to, as defined in Cluster API.
                type: string
              hardware:
                default:
                  cpu: 2
                  disk: 50G
                  memory: 4096
                  networkDevice:
                    bridge: vmbr0
                    firewall: true
                    model: virtio
                description: Hardware
                properties:
                  bios:
                    description: |-
                      Select BIOS implementation. Defaults to seabios. seabios or ovmf.
                      Defaults to seabios.
                    enum:
                    - seabios
                    - ovmf
                    type: string
                  cpu:
                    default: 2
                    description: 'number of CPU cores : 1 ~'
                    minimum: 1
                    type: integer
                  cpuLimit:
                    description: |-
                      Limit of CPU usage. If the computer has 2 CPUs, it has total of '2' CPU time.
                      Value '0' indicates no CPU limit. Defaults to 0.
                    minimum: 0
                    type: integer
                  cpuType:
                    description: Emulated CPU Type. Defaults to kvm64
                    type: string
                  disk:
                    default: 50G
                    description: hard disk size
                    pattern: \+?\d+(\.\d+)?[KMGT]?
                    type: string
                  memory:
                    default: 4096
                    description: 'amount of RAM for the VM in MiB : 16 ~'
                    minimum: 16
                    type: integer
                  networkDevice:
                    default:
                      bridge: vmbr0
                      firewall: true
                      model: virtio
                    description: |-
                      network devices
                      to do: multiple devices
                    properties:
                      bridge:
                        default: vmbr0
                        pattern: vmbr[0-9]{1,4}
                        type: string
                      firewall:
                        default: true
                        type: boolean
                      linkDown:
                        type: boolean
                      macAddr:
                        type: string
                      model:
                        default: virtio
                        enum:
                        - e1000
                        - virtio
                        - rtl8139
                        - vmxnet3
                        type: string
                      mtu:
                        type: integer
                      queues:
                        type: integer
                      rate:
                        description: since float is highly discouraged, use string
                          instead
                        pattern: '[0-9]+(\.|)[0-9]*'
                        type: string
                      tag:
                        type: integer
                      trunks:
                        description: 'trunks: array of vlanid'
                        items:
                          type: integer
                        type: array
                    type: object
                  sockets:
                    description: The number of CPU sockets. Defaults to 1.
                    minimum: 1
                    type: integer
                type: object
              image:
                description: Image is the image to be provisioned
                properties:
                  checksum:
                    description: |-
                      Checksum
                      Always better to specify checksum otherwise cappx will download
                      same image for every time. If checksum is specified, cappx will try
                      to avoid downloading existing image.
                    type: string
                  checksumType:
                    description: ChecksumType
                    enum:
                    - sha256
                    - sha256sum
                    - md5
                    - md5sum
                    type: string
                  url:
                    description: |-
                      URL is a location of an image to deploy.
                      supported formats are iso/qcow2/qed/raw/vdi/vpc/vmdk.
                    pattern: .*\.(iso|img|qcow2|qed|raw|vdi|vpc|vmdk)$
                    type: string
                required:
                - url
                type: object
              network:
                description: Network
                properties:
                  ipConfig:
                    description: 'to do : should accept multiple IPConfig'
                    properties:
                      gateway:
                        description: gateway IPv4
                        type: string
                      gateway6:
                        description: gateway IPv6
                        type: string
                      ip:
                        description: IPv4 with CIDR
                        type: string
                      ip6:
                        description: IPv6 with CIDR
                        type: string
                    type: object
                  nameServer:
                    description: DNS server
                    type: string
                  searchDomain:
                    description: search domain
                    type: string
                type: object
              node:
                description: Node is proxmox node hosting vm instance which used for
                  ProxmoxMachine
                type: string
              options:
                description: Options for QEMU instance
                properties:
                  acpi:
                    description: Enable/Disable ACPI. Defaults to true.
                    type: boolean
                  arch:
                    description: Virtual processor architecture. Defaults to the host.
                      x86_64 or aarch64.
                    enum:
                    - x86_64
                    - aarch64
                    type: string
                  balloon:
                    description: Amount of target RAM for the VM in MiB. Using zero
                      disables the ballon driver.
                    minimum: 0
                    type: integer
                  description:
                    description: |-
                      Description for the VM. Shown in the web-interface VM's summary.
                      This is saved as comment inside the configuration file.
                    type: string
                  hugePages:
                    description: enable/disable hugepages memory. 0 or 2 or 1024.
                      0 indicated 'any'
                    enum:
                    - 0
                    - 2
                    - 1024
                    type: integer
                  keepHugePages:
                    description: |-
                      Use together with hugepages. If enabled, hugepages will not not be deleted
                      after VM shutdown and can be used for subsequent starts. Defaults to false.
                    type: boolean
                  kvm:
                    description: Enable/disable KVM hardware virtualization. Defaults
                      to true.
                    type: boolean
                  localTime:
                    description: |-
                      Set the real time clock (RTC) to local time.
                      This is enabled by default if the `ostype` indicates a Microsoft Windows OS.
                    type: boolean
                  lock:
                    description: Lock/unlock the VM.
                    enum:
                    - backup
                    - clone
                    - create
                    - migrate
                    - rollback
                    - snapshot
                    - snapshot-delete
                    - suspending
                    - suspended
                    type: string
                  numa:
                    description: Enable/disable NUMA.
                    type: boolean
                  onBoot:
                    description: Specifies whether a VM will be started during system
                      bootup.
                    type: boolean
                  osType:
                    description: |-
                      Specify guest operating system. This is used to enable special
                      optimization/features for specific operating systems.
                    enum:
                    - other
                    - wxp
                    - w2k
                    - w2k3
                    - w2k8
                    - wvista
                    - win7
                    - win8
                    - win10
                    - win11
                    - l24
                    - l26
                    - solaris
                    type: string
                  protection:
                    description: |-
                      Sets the protection flag of the VM.
                      This will disable the remove VM and remove disk operations.
                      Defaults to false.
                    type: boolean
                  reboot:
                    description: |-
                      Allow reboot. If set to 'false' the VM exit on reboot.
                      Defaults to true.
                    type: boolean
                  shares:
                    description: |-
                      Amount of memory shares for auto-ballooning. The larger the number is, the more memory this VM gets.
                      Number is relative to weights of all other running VMs. Using zero disables auto-ballooning.
                      Auto-ballooning is done by pvestatd. 0 ~ 5000. Defaults to 1000.
                    maximum: 5000
                    minimum: 0
                    type: integer
                  tablet:
                    description: |-
                      Enable/disable the USB tablet device. This device is usually needed to allow
                      absolute mouse positioning with VNC. Else the mouse runs out of sync with normal VNC clients.
                      If you're running lots of console-only guests on one host,
                      you may consider disabling this to save some context switches.
                      This is turned off by default if you use spice (`qm set <vmid> --vga qxl`).
                      Defaults to true.
                    type: boolean
                  tags:
                    description: Tags of the VM. This is only meta information.
                    items:
                      pattern: '[a-zA-Z0-9-_.;]+'
                      type: string
                    type: array
                  template:
                    description: Enable/disable Template. Defaults to false.
                    type: boolean
                  timeDriftFix:
                    description: Enable/disable time drift fix. Defaults to false.
                    type: boolean
                  vcpus:
                    description: Number of hotplugged vcpus. Defaults to 0.
                    minimum: 0
                    type: integer
                  vmGenerationID:
                    description: |-
                      The VM generation ID (vmgenid) device exposes a 128-bit integer value identifier to the guest OS.
                      This allows to notify the guest operating system when the virtual machine is executed with a different configuration
                      (e.g. snapshot execution or creation from a template).
                      The guest operating system notices the change, and is then able to react as appropriate by marking its copies of distributed databases as dirty,
                      re-initializing its random number generator, etc.
                      Note that auto-creation only works when done through API/CLI create or update methods, but not when manually editing the config file.
                      regex: (?:[a-fA-F0-9]{8}(?:-[a-fA-F0-9]{4}){3}-[a-fA-F0-9]{12}|[01]). Defaults to 1 (autogenerated)
                    pattern: (?:[a-fA-F0-9]{8}(?:-[a-fA-F0-9]{4}){3}-[a-fA-F0-9]{12}|[01])
                    type: string
                type: object
              providerID:
                description: ProviderID
                type: string
              storage:
                description: |-
                  Storage is name of proxmox storage used by this node.
                  The storage must support "images(VM Disks)" type of content.
                  cappx will use random storage if empty
                type: string
              vmID:
                description: VMID is proxmox qemu's id
                minimum: 0
                type: integer
            required:
            - image
            type: object
          status:
            description: ProxmoxMachineStatus defines the observed state of ProxmoxMachine
            properties:
              addresses:
                description: Addresses
                items:
                  description: MachineAddress contains information for the node's
                    address.
                  properties:
                    address:
                      description: The machine address.
                      type: string
                    type:
                      description: Machine address type, one of Hostname, ExternalIP,
                        InternalIP, ExternalDNS or InternalDNS.
                      type: string
                  required:
                  - address
                  - type
                  type: object
                type: array
              conditions:
                description: Conditions
                items:
                  description: Condition defines an observation of a Cluster API resource
                    operational state.
                  properties:
                    lastTransitionTime:
                      description: |-
                        Last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed. If that is not known, then using the time when
                        the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        A human readable message indicating details about the transition.
                        This field may be empty.
                      type: string
                    reason:
                      description: |-
                        The reason for the condition's last transition in CamelCase.
                        The specific API may choose whether or not this field is considered a guaranteed API.
                        This field may not be empty.
                      type: string
                    severity:
                      description: |-
                        Severity provides an explicit classification of Reason code, so the users or machines can immediately
                        understand the current situation and act accordingly.
                        The Severity field MUST be set only when Status=False.
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown.
                      type: string
                    type:
                      description: |-
                        Type of condition in CamelCase or in foo.example.com/CamelCase.
                        Many .condition.type values are consistent across resources like Available, but because arbitrary conditions
                        can be useful (see .node.status.conditions), the ability to deconflict is important.
                      type: string
                  required:
                  - lastTransitionTime
                  - status
                  - type
                  type: object
                type: array
              config:
                description: Configuration
                properties:
                  acpi:
                    description: Enable/disable ACPI.
                    type: integer
                  affinity:
                    description: 'List of host cores used to execute guest processes,
                      for example: 0,5,8-11'
                    type: string
                  agent:
                    description: Enable/disable communication with the QEMU Guest
                      Agent and its properties.
                    type: string
                  arch:
                    description: Virtual processor architecture. Defaults to the host.
                    type: string
                  args:
                    description: |-
                      Arbitrary arguments passed to kvm, for example:
                      args: -no-reboot -no-hpet
                      NOTE: this option is for experts only.
                    type: string
                  audio0:
                    description: Configure a audio device, useful in combination with
                      QXL/Spice.
                    type: string
                  autostart:
                    description: Automatic restart after crash (currently ignored).
                    type: integer
                  balloon:
                    description: Amount of target RAM for the VM in MiB. Using zero
                      disables the ballon driver.
                    type: integer
                  bios:
                    description: Select BIOS implementation.
                    type: string
                  boot:
                    description: 'boot order. ";" separated. : ''order=device1;device2;device3'''
                    type: string
                  cdrom:
                    description: This is an alias for option -ide2
                    type: string
                  cicustom:
                    description: 'cloud-init: Specify custom files to replace the
                      automatically generated ones at start.'
                    type: string
                  cipassword:
                    description: |-
                      cloud-init: Password to assign the user. Using this is generally not recommended.
                      Use ssh keys instead. Also note that older cloud-init versions do not support hashed passwords.
                    type: string
                  citype:
                    description: |-
                      Specifies the cloud-init configuration format.
                      The default depends on the configured operating system type (`ostype`.
                      We use the `nocloud` format for Linux, and `configdrive2` for windows.
                    type: string
                  ciuser:
                    description: 'cloud-init: User name to change ssh keys and password
                      for instead of the image''s configured default user.'
                    type: string
                  cores:
                    description: 'The number of cores per socket. : 1 ~'
                    type: integer
                  cpu:
                    description: emulated cpu type
                    type: string
                  cpulimit:
                    description: |-
                      Limit of CPU usage.
                      NOTE: If the computer has 2 CPUs, it has total of '2' CPU time. Value '0' indicates no CPU limit.
                    type: integer
                  cpuunits:
                    description: |-
                      CPU weight for a VM. Argument is used in the kernel fair scheduler.
                      The larger the number is, the more CPU time this VM gets.
                      Number is relative to weights of all the other running VMs.
                    type: integer
                  description:
                    type: string
                  efidisk0:
                    type: integer
                  freeze:
                    type: integer
                  hookscript:
                    type: string
                  hostpci0:
                    type: string
                  hostpci1:
                    type: string
                  hostpci2:
                    type: string
                  hostpci3:
                    type: string
                  hotplug:
                    type: string
                  hugepages:
                    type: string
                  ide0:
                    type: string
                  ide1:
                    type: string
                  ide2:
                    type: string
                  ide3:
                    type: string
                  ipconfig0:
                    type: string
                  ipconfig1:
                    type: string
                  ipconfig2:
                    type: string
                  ipconfig3:
                    type: string
                  ipconfig4:
                    type: string
                  ipconfig5:
                    type: string
                  ipconfig6:
                    type: string
                  ipconfig7:
                    type: string
                  ipconfig8:
                    type: string
                  ipconfig9:
                    type: string
                  ipconfig10:
                    type: string
                  ipconfig11:
                    type: string
                  ipconfig12:
                    type: string
                  ipconfig13:
                    type: string
                  ipconfig14:
                    type: string
                  ipconfig15:
                    type: string
                  ipconfig16:
                    type: string
                  ipconfig17:
                    type: string
                  ipconfig18:
                    type: string
                  ipconfig19:
                    type: string
                  ipconfig20:
                    type: string
                  ipconfig21:
                    type: string
                  ipconfig22:
                    type: string
                  ipconfig23:
                    type: string
                  ipconfig24:
                    type: string
                  ipconfig25:
                    type: string
                  ipconfig26:
                    type: string
                  ipconfig27:
                    type: string
                  ipconfig28:
                    type: string
                  ipconfig29:
                    type: string
                  ipconfig30:
                    type: string
                  ipconfig31:
                    type: string
                  ivshmem:
                    type: string
                  keephugepages:
                    type: integer
                  keyboard:
                    type: string
                  kvm:
                    description: enable/disable KVM hardware virtualization
                    type: integer
                  localtime:
                    type: integer
                  lock:
                    type: string
                  machine:
                    description: specifies the QEMU machine type
                    type: string
                  memory:
                    description: 'amount of RAM for the VM in MiB : 16 ~'
                    type: integer
                  migrate_downtime:
                    description: A Number represents a JSON number literal.
                    type: string
                  migrate_speed:
                    type: integer
                  name:
                    description: name for VM. Only used on the configuration web interface
                    type: string
                  nameserver:
                    description: 'cloud-init: Sets DNS server IP address for a container.
                      Create will automatically use the setting from the host if neither
                      searchdomain nor nameserver are set.'
                    type: string
                  net0:
                    type: string
                  net1:
                    type: string
                  net2:
                    type: string
                  net3:
                    type: string
                  net4:
                    type: string
                  net5:
                    type: string
                  net6:
                    type: string
                  net7:
                    type: string
                  net8:
                    type: string
                  net9:
                    type: string
                  net10:
                    type: string
                  net11:
                    type: string
                  net12:
                    type: string
                  net13:
                    type: string
                  net14:
                    type: string
                  net15:
                    type: string
                  net16:
                    type: string
                  net17:
                    type: string
                  net18:
                    type: string
                  net19:
                    type: string
                  net20:
                    type: string
                  net21:
                    type: string
                  net22:
                    type: string
                  net23:
                    type: string
                  net24:
                    type: string
                  net25:
                    type: string
                  net26:
                    type: string
                  net27:
                    type: string
                  net28:
                    type: string
                  net29:
                    type: string
                  net30:
                    type: string
                  net31:
                    type: string
                  numa:
                    type: integer
                  numa0:
                    type: string
                  numa1:
                    type: string
                  numa2:
                    type: string
                  numa3:
                    type: string
                  numa4:
                    type: string
                  numa5:
                    type: string
                  numa6:
                    type: string
                  numa7:
                    type: string
                  onboot:
                    description: specifies whether a VM will be started during system
                      bootup
                    type: integer
                  ostype:
                    description: quest OS
                    type: string
                  parallel0:
                    type: string
                  parallel1:
                    type: string
                  parallel2:
                    type: string
                  protection:
                    type: integer
                  reboot:
                    description: Allow reboot. if set to '0' the VM exit on reboot
                    type: integer
                  rng0:
                    type: string
                  sata0:
                    type: string
                  sata1:
                    type: string
                  sata2:
                    type: string
                  sata3:
                    type: string
                  sata4:
                    type: string
                  sata5:
                    type: string
                  scsi0:
                    type: string
                  scsi1:
                    type: string
                  scsi2:
                    type: string
                  scsi3:
                    type: string
                  scsi4:
                    type: string
                  scsi5:
                    type: string
                  scsi6:
                    type: string
                  scsi7:
                    type: string
                  scsi8:
                    type: string
                  scsi9:
                    type: string
                  scsi10:
                    type: string
                  scsi11:
                    type: string
                  scsi12:
                    type: string
                  scsi13:
                    type: string
                  scsi14:
                    type: string
                  scsi15:
                    type: string
                  scsi16:
                    type: string
                  scsi17:
                    type: string
                  scsi18:
                    type: string
                  scsi19:
                    type: string
                  scsi20:
                    type: string
                  scsi21:
                    type: string
                  scsi22:
                    type: string
                  scsi23:
                    type: string
                  scsi24:
                    type: string
                  scsi25:
                    type: string
                  scsi26:
                    type: string
                  scsi27:
                    type: string
                  scsi28:
                    type: string
                  scsi29:
                    type: string
                  scsi30:
                    type: string
                  scsihw:
                    description: SCSI controller model
                    type: string
                  searchdomain:
                    description: 'cloud-init: Sets DNS search domains for a container.
                      Create will automatically use the setting from the host if neither
                      searchdomain nor nameserver are set.'
                    type: string
                  serial0:
                    type: string
                  serial1:
                    type: string
                  serial2:
                    type: string
                  serial3:
                    type: string
                  shares:
                    type: integer
                  smbios1:
                    type: string
                  smp:
                    type: integer
                  sockets:
                    description: number of sockets
                    type: integer
                  spice_enhancements:
                    type: string
                  sshkeys:
                    description: cloud-init setup public ssh keys (one key per line,
                      OpenSSH format)
                    type: string
                  startdate:
                    type: string
                  startup:
                    type: integer
                  tablet:
                    type: integer
                  tags:
                    description: tags of the VM. only for meta information
                    type: string
                  tdf:
                    type: integer
                  template:
                    description: enable/disable template
                    type: integer
                  tpmstate:
                    type: string
                  unused0:
                    type: string
                  unused1:
                    type: string
                  unused2:
                    type: string
                  unused3:
                    type: string
                  unused4:
                    type: string
                  unused5:
                    type: string
                  unused6:
                    type: string
                  unused7:
                    type: string
                  vcpus:
                    type: integer
                  vga:
                    type: string
                  virtio0:
                    type: string
                  virtio1:
                    type: string
                  virtio2:
                    type: string
                  virtio3:
                    type: string
                  virtio4:
                    type: string
                  virtio5:
                    type: string
                  virtio6:
                    type: string
                  virtio7:
                    type: string
                  virtio8:
                    type: string
                  virtio9:
                    type: string
                  virtio10:
                    type: string
                  virtio11:
                    type: string
                  virtio12:
                    type: string
                  virtio13:
                    type: string
                  virtio14:
                    type: string
                  virtio15:
                    type: string
                  vmgenid:
                    type: string
                  vmstatestorage:
                    type: string
                  watchdog:
                    type: string
                type: object
              failureMessage:
                description: FailureMessage
                type: string
              failureReason:
                description: FailureReason
                type: string
              instanceStatus:
                description: InstanceStatus is the status of the proxmox instance
                  for this machine.
                type: string
              ready:
                description: Ready is true when the provider resource is ready.
                type: boolean
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.1
  labels:
    cluster.x-k8s.io/provider: infrastructure-proxmox
    cluster.x-k8s.io/v1beta1: v1beta1
  name: proxmoxmachinetemplates.infrastructure.cluster.x-k8s.io
spec:
  group: infrastructure.cluster.x-k8s.io
  names:
    kind: ProxmoxMachineTemplate
    listKind: ProxmoxMachineTemplateList
    plural: proxmoxmachinetemplates
    singular: proxmoxmachinetemplate
  scope: Namespaced
  versions:
  - name: v1beta1
    schema:
      openAPIV3Schema:
        description: ProxmoxMachineTemplate is the Schema for the proxmoxmachinetemplates
          API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: ProxmoxMachineTemplateSpec defines the desired state of ProxmoxMachineTemplate
            properties:
              template:
                properties:
                  metadata.omitempty:
                    description: |-
                      ObjectMeta is metadata that all persisted resources must have, which includes all objects
                      users must create. This is a copy of customizable fields from metav1.ObjectMeta.

                      ObjectMeta is embedded in `Machine.Spec`, `MachineDeployment.Template` and `MachineSet.Template`,
                      which are not top-level Kubernetes objects. Given that metav1.ObjectMeta has lots of special cases
                      and read-only fields which end up in the generated CRD validation, having it as a subset simplifies
                      the API and some issues that can impact user experience.

                      During the [upgrade to controller-tools@v2](https://github.com/kubernetes-sigs/cluster-api/pull/1054)
                      for v1alpha2, we noticed a failure would occur running Cluster API test suite against the new CRDs,
                      specifically `spec.metadata.creationTimestamp in body must be of type string: "null"`.
                      The investigation showed that `controller-tools@v2` behaves differently than its previous version
                      when handling types from [metav1](k8s.io/apimachinery/pkg/apis/meta/v1) package.

                      In more details, we found that embedded (non-top level) types that embedded `metav1.ObjectMeta`
                      had validation properties, including for `creationTimestamp` (metav1.Time).
                      The `metav1.Time` type specifies a custom json marshaller that, when IsZero() is true, returns `null`
                      which breaks validation because the field isn't marked as nullable.

                      In future versions, controller-tools@v2 might allow overriding the type and validation for embedded
                      types. When that happens, this hack should be revisited.
                    properties:
                      annotations:
                        additionalProperties:
                          type: string
                        description: |-
                          Annotations is an unstructured key value map stored with a resource that may be
                          set by external tools to store and retrieve arbitrary metadata. They are not
                          queryable and should be preserved when modifying objects.
                          More info: http://kubernetes.io/docs/user-guide/annotations
                        type: object
                      labels:
                        additionalProperties:
                          type: string
                        description: |-
                          Map of string keys and values that can be used to organize and categorize
                          (scope and select) objects. May match selectors of replication controllers
                          and services.
                          More info: http://kubernetes.io/docs/user-guide/labels
                        type: object
                    type: object
                  spec:
                    description: ProxmoxMachineSpec defines the desired state of ProxmoxMachine
                    properties:
                      cloudInit:
                        description: |-
                          CloudInit defines options related to the bootstrapping systems where
                          CloudInit is used.
                        properties:
                          user:
                            properties:
                              bootcmd:
                                items:
                                  type: string
                                type: array
                              ca_certs:
                                properties:
                                  remove_defaults:
                                    type: boolean
                                  trusted:
                                    items:
                                      type: string
                                    type: array
                                type: object
                              chpasswd:
                                properties:
                                  expire:
                                    type: string
                                type: object
                              manage_etc_hosts:
                                type: boolean
                              no_ssh_fingerprints:
                                type: boolean
                              package_update:
                                type: boolean
                              package_upgrade:
                                type: boolean
                              packages:
                                items:
                                  type: string
                                type: array
                              password:
                                type: string
                              runCmd:
                                items:
                                  type: string
                                type: array
                              ssh:
                                properties:
                                  emit_keys_to_console:
                                    type: boolean
                                type: object
                              ssh_authorized_keys:
                                items:
                                  type: string
                                type: array
                              ssh_keys:
                                properties:
                                  dsa_private:
                                    type: string
                                  dsa_public:
                                    type: string
                                  ecdsa_private:
                                    type: string
                                  ecdsa_public:
                                    type: string
                                  rsa_private:
                                    type: string
                                  rsa_public:
                                    type: string
                                type: object
                              ssh_pwauth:
                                type: boolean
                              user:
                                type: string
                              users:
                                items:
                                  properties:
                                    expiredate:
                                      pattern: ^/d{4}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[01])$
                                      type: string
                                    gecos:
                                      type: string
                                    groups:
                                      items:
                                        type: string
                                      type: array
                                    homedir:
                                      pattern: ^/.+
                                      type: string
                                    inactive:
                                      minimum: 0
                                      type: integer
                                    lock_passwd:
                                      type: boolean
                                    name:
                                      type: string
                                    no_create_home:
                                      type: boolean
                                    no_log_init:
                                      type: boolean
                                    no_user_group:
                                      type: boolean
                                    passwd:
                                      type: string
                                    primary_group:
                                      type: string
                                    selinux_user:
                                      type: string
                                    shell:
                                      type: string
                                    snapuser:
                                      type: string
                                    ssh_authorized_keys:
                                      items:
                                        type: string
                                      type: array
                                    ssh_import_id:
                                      items:
                                        type: string
                                      type: array
                                    ssh_redirect_user:
                                      type: boolean
                                    sudo:
                                      items:
                                        type: string
                                      type: array
                                    system:
                                      type: boolean
                                  required:
                                  - name
                                  type: object
                                type: array
                              writeFiles:
                                items:
                                  properties:
                                    content:
                                      type: string
                                    defer:
                                      type: boolean
                                    encoding:
                                      type: string
                                    owner:
                                      type: string
                                    path:
                                      type: string
                                    permissions:
                                      type: string
                                  type: object
                                type: array
                            type: object
                        type: object
                      failureDomain:
                        description: FailureDomain is the failure domain unique identifier
                          this Machine should be attached to, as defined in Cluster
                          API.
                        type: string
                      hardware:
                        default:
                          cpu: 2
                          disk: 50G
                          memory: 4096
                          networkDevice:
                            bridge: vmbr0
                            firewall: true
                            model: virtio
                        description: Hardware
                        properties:
                          bios:
                            description: |-
                              Select BIOS implementation. Defaults to seabios. seabios or ovmf.
                              Defaults to seabios.
                            enum:
                            - seabios
                            - ovmf
                            type: string
                          cpu:
                            default: 2
                            description: 'number of CPU cores : 1 ~'
                            minimum: 1
                            type: integer
                          cpuLimit:
                            description: |-
                              Limit of CPU usage. If the computer has 2 CPUs, it has total of '2' CPU time.
                              Value '0' indicates no CPU limit. Defaults to 0.
                            minimum: 0
                            type: integer
                          cpuType:
                            description: Emulated CPU Type. Defaults to kvm64
                            type: string
                          disk:
                            default: 50G
                            description: hard disk size
                            pattern: \+?\d+(\.\d+)?[KMGT]?
                            type: string
                          memory:
                            default: 4096
                            description: 'amount of RAM for the VM in MiB : 16 ~'
                            minimum: 16
                            type: integer
                          networkDevice:
                            default:
                              bridge: vmbr0
                              firewall: true
                              model: virtio
                            description: |-
                              network devices
                              to do: multiple devices
                            properties:
                              bridge:
                                default: vmbr0
                                pattern: vmbr[0-9]{1,4}
                                type: string
                              firewall:
                                default: true
                                type: boolean
                              linkDown:
                                type: boolean
                              macAddr:
                                type: string
                              model:
                                default: virtio
                                enum:
                                - e1000
                                - virtio
                                - rtl8139
                                - vmxnet3
                                type: string
                              mtu:
                                type: integer
                              queues:
                                type: integer
                              rate:
                                description: since float is highly discouraged, use
                                  string instead
                                pattern: '[0-9]+(\.|)[0-9]*'
                                type: string
                              tag:
                                type: integer
                              trunks:
                                description: 'trunks: array of vlanid'
                                items:
                                  type: integer
                                type: array
                            type: object
                          sockets:
                            description: The number of CPU sockets. Defaults to 1.
                            minimum: 1
                            type: integer
                        type: object
                      image:
                        description: Image is the image to be provisioned
                        properties:
                          checksum:
                            description: |-
                              Checksum
                              Always better to specify checksum otherwise cappx will download
                              same image for every time. If checksum is specified, cappx will try
                              to avoid downloading existing image.
                            type: string
                          checksumType:
                            description: ChecksumType
                            enum:
                            - sha256
                            - sha256sum
                            - md5
                            - md5sum
                            type: string
                          url:
                            description: |-
                              URL is a location of an image to deploy.
                              supported formats are iso/qcow2/qed/raw/vdi/vpc/vmdk.
                            pattern: .*\.(iso|img|qcow2|qed|raw|vdi|vpc|vmdk)$
                            type: string
                        required:
                        - url
                        type: object
                      network:
                        description: Network
                        properties:
                          ipConfig:
                            description: 'to do : should accept multiple IPConfig'
                            properties:
                              gateway:
                                description: gateway IPv4
                                type: string
                              gateway6:
                                description: gateway IPv6
                                type: string
                              ip:
                                description: IPv4 with CIDR
                                type: string
                              ip6:
                                description: IPv6 with CIDR
                                type: string
                            type: object
                          nameServer:
                            description: DNS server
                            type: string
                          searchDomain:
                            description: search domain
                            type: string
                        type: object
                      node:
                        description: Node is proxmox node hosting vm instance which
                          used for ProxmoxMachine
                        type: string
                      options:
                        description: Options for QEMU instance
                        properties:
                          acpi:
                            description: Enable/Disable ACPI. Defaults to true.
                            type: boolean
                          arch:
                            description: Virtual processor architecture. Defaults
                              to the host. x86_64 or aarch64.
                            enum:
                            - x86_64
                            - aarch64
                            type: string
                          balloon:
                            description: Amount of target RAM for the VM in MiB. Using
                              zero disables the ballon driver.
                            minimum: 0
                            type: integer
                          description:
                            description: |-
                              Description for the VM. Shown in the web-interface VM's summary.
                              This is saved as comment inside the configuration file.
                            type: string
                          hugePages:
                            description: enable/disable hugepages memory. 0 or 2 or
                              1024. 0 indicated 'any'
                            enum:
                            - 0
                            - 2
                            - 1024
                            type: integer
                          keepHugePages:
                            description: |-
                              Use together with hugepages. If enabled, hugepages will not not be deleted
                              after VM shutdown and can be used for subsequent starts. Defaults to false.
                            type: boolean
                          kvm:
                            description: Enable/disable KVM hardware virtualization.
                              Defaults to true.
                            type: boolean
                          localTime:
                            description: |-
                              Set the real time clock (RTC) to local time.
                              This is enabled by default if the `ostype` indicates a Microsoft Windows OS.
                            type: boolean
                          lock:
                            description: Lock/unlock the VM.
                            enum:
                            - backup
                            - clone
                            - create
                            - migrate
                            - rollback
                            - snapshot
                            - snapshot-delete
                            - suspending
                            - suspended
                            type: string
                          numa:
                            description: Enable/disable NUMA.
                            type: boolean
                          onBoot:
                            description: Specifies whether a VM will be started during
                              system bootup.
                            type: boolean
                          osType:
                            description: |-
                              Specify guest operating system. This is used to enable special
                              optimization/features for specific operating systems.
                            enum:
                            - other
                            - wxp
                            - w2k
                            - w2k3
                            - w2k8
                            - wvista
                            - win7
                            - win8
                            - win10
                            - win11
                            - l24
                            - l26
                            - solaris
                            type: string
                          protection:
                            description: |-
                              Sets the protection flag of the VM.
                              This will disable the remove VM and remove disk operations.
                              Defaults to false.
                            type: boolean
                          reboot:
                            description: |-
                              Allow reboot. If set to 'false' the VM exit on reboot.
                              Defaults to true.
                            type: boolean
                          shares:
                            description: |-
                              Amount of memory shares for auto-ballooning. The larger the number is, the more memory this VM gets.
                              Number is relative to weights of all other running VMs. Using zero disables auto-ballooning.
                              Auto-ballooning is done by pvestatd. 0 ~ 5000. Defaults to 1000.
                            maximum: 5000
                            minimum: 0
                            type: integer
                          tablet:
                            description: |-
                              Enable/disable the USB tablet device. This device is usually needed to allow
                              absolute mouse positioning with VNC. Else the mouse runs out of sync with normal VNC clients.
                              If you're running lots of console-only guests on one host,
                              you may consider disabling this to save some context switches.
                              This is turned off by default if you use spice (`qm set <vmid> --vga qxl`).
                              Defaults to true.
                            type: boolean
                          tags:
                            description: Tags of the VM. This is only meta information.
                            items:
                              pattern: '[a-zA-Z0-9-_.;]+'
                              type: string
                            type: array
                          template:
                            description: Enable/disable Template. Defaults to false.
                            type: boolean
                          timeDriftFix:
                            description: Enable/disable time drift fix. Defaults to
                              false.
                            type: boolean
                          vcpus:
                            description: Number of hotplugged vcpus. Defaults to 0.
                            minimum: 0
                            type: integer
                          vmGenerationID:
                            description: |-
                              The VM generation ID (vmgenid) device exposes a 128-bit integer value identifier to the guest OS.
                              This allows to notify the guest operating system when the virtual machine is executed with a different configuration
                              (e.g. snapshot execution or creation from a template).
                              The guest operating system notices the change, and is then able to react as appropriate by marking its copies of distributed databases as dirty,
                              re-initializing its random number generator, etc.
                              Note that auto-creation only works when done through API/CLI create or update methods, but not when manually editing the config file.
                              regex: (?:[a-fA-F0-9]{8}(?:-[a-fA-F0-9]{4}){3}-[a-fA-F0-9]{12}|[01]). Defaults to 1 (autogenerated)
                            pattern: (?:[a-fA-F0-9]{8}(?:-[a-fA-F0-9]{4}){3}-[a-fA-F0-9]{12}|[01])
                            type: string
                        type: object
                      providerID:
                        description: ProviderID
                        type: string
                      storage:
                        description: |-
                          Storage is name of proxmox storage used by this node.
                          The storage must support "images(VM Disks)" type of content.
                          cappx will use random storage if empty
                        type: string
                      vmID:
                        description: VMID is proxmox qemu's id
                        minimum: 0
                        type: integer
                    required:
                    - image
                    type: object
                required:
                - spec
                type: object
            required:
            - template
            type: object
          status:
            description: ProxmoxMachineTemplateStatus defines the observed state of
              ProxmoxMachineTemplate
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
---
apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: rbac
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: controller-manager-sa
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: serviceaccount
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-controller-manager
  namespace: cappx-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/component: rbac
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: leader-election-role
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: role
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-leader-election-role
  namespace: cappx-system
rules:
- apiGroups:
  - ""
  resources:
  - configmaps
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - get
  - list
  - watch
  - create
  - update
  - patch
  - delete
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - patch
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-manager-role
rules:
- apiGroups:
  - ""
  resources:
  - events
  verbs:
  - create
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - ""
  resources:
  - secrets
  verbs:
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - cluster.x-k8s.io
  resources:
  - clusters
  - clusters/status
  - machines
  - machines/status
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - infrastructure.cluster.x-k8s.io
  resources:
  - proxmoxclusters
  - proxmoxmachines
  verbs:
  - create
  - delete
  - get
  - list
  - patch
  - update
  - watch
- apiGroups:
  - infrastructure.cluster.x-k8s.io
  resources:
  - proxmoxclusters/finalizers
  - proxmoxmachines/finalizers
  verbs:
  - update
- apiGroups:
  - infrastructure.cluster.x-k8s.io
  resources:
  - proxmoxclusters/status
  - proxmoxmachines/status
  verbs:
  - get
  - patch
  - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: kube-rbac-proxy
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: metrics-reader
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: clusterrole
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-metrics-reader
rules:
- nonResourceURLs:
  - /metrics
  verbs:
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: kube-rbac-proxy
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: proxy-role
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: clusterrole
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-proxy-role
rules:
- apiGroups:
  - authentication.k8s.io
  resources:
  - tokenreviews
  verbs:
  - create
- apiGroups:
  - authorization.k8s.io
  resources:
  - subjectaccessreviews
  verbs:
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: rbac
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: leader-election-rolebinding
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: rolebinding
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-leader-election-rolebinding
  namespace: cappx-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: cappx-leader-election-role
subjects:
- kind: ServiceAccount
  name: cappx-controller-manager
  namespace: cappx-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/component: rbac
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: manager-rolebinding
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: clusterrolebinding
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-manager-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cappx-manager-role
subjects:
- kind: ServiceAccount
  name: cappx-controller-manager
  namespace: cappx-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/component: kube-rbac-proxy
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: proxy-rolebinding
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: clusterrolebinding
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
  name: cappx-proxy-rolebinding
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cappx-proxy-role
subjects:
- kind: ServiceAccount
  name: cappx-controller-manager
  namespace: cappx-system
---
apiVersion: v1
data:
  plugin-config.yaml: |
    filters:
      CPUOvercommit:
        enable: false
      MemoryOvercommit:
        enable: false
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/component: manager
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: system
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: namespace
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/provider: infrastructure-proxmox
    control-plane: cappx-controller-manager
  name: cappx-qemu-scheduler-configs
  namespace: cappx-system
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: kube-rbac-proxy
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: controller-manager-metrics-service
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: service
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
    control-plane: controller-manager
  name: cappx-controller-manager-metrics-service
  namespace: cappx-system
spec:
  ports:
  - name: https
    port: 8443
    protocol: TCP
    targetPort: https
  selector:
    cluster.x-k8s.io/aggregate-to-manager: "true"
    cluster.x-k8s.io/provider: infrastructure-proxmox
    control-plane: controller-manager
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app.kubernetes.io/component: manager
    app.kubernetes.io/created-by: cluster-api-provider-proxmox
    app.kubernetes.io/instance: cappx-controller-manager
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/name: deployment
    app.kubernetes.io/part-of: cluster-api-provider-proxmox
    cluster.x-k8s.io/provider: infrastructure-proxmox
    control-plane: cappx-controller-manager
  name: cappx-controller-manager
  namespace: cappx-system
spec:
  replicas: 1
  selector:
    matchLabels:
      cluster.x-k8s.io/provider: infrastructure-proxmox
      control-plane: cappx-controller-manager
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/default-container: manager
      labels:
        cluster.x-k8s.io/provider: infrastructure-proxmox
        control-plane: cappx-controller-manager
    spec:
      affinity:
        nodeAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            nodeSelectorTerms:
            - matchExpressions:
              - key: kubernetes.io/arch
                operator: In
                values:
                - amd64
                - arm64
                - ppc64le
                - s390x
              - key: kubernetes.io/os
                operator: In
                values:
                - linux
      containers:
      - args:
        - --secure-listen-address=0.0.0.0:8443
        - --upstream=http://127.0.0.1:8080/
        - --logtostderr=true
        - --v=0
        image: gcr.io/kubebuilder/kube-rbac-proxy:v0.13.1
        name: kube-rbac-proxy
        ports:
        - containerPort: 8443
          name: https
          protocol: TCP
        resources:
          limits:
            cpu: 500m
            memory: 128Mi
          requests:
            cpu: 5m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
      - args:
        - --health-probe-bind-address=:8081
        - --diagnostics-address=127.0.0.1:8080
        - --leader-elect
        - --scheduler-plugin-config=/etc/qemu-scheduler/plugin-config.yaml
        command:
        - /manager
        image: ghcr.io/k8s-proxmox/cluster-api-provider-proxmox:v0.4.3
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 15
          periodSeconds: 20
        name: manager
        readinessProbe:
          httpGet:
            path: /readyz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          limits:
            cpu: 500m
            memory: 128Mi
          requests:
            cpu: 10m
            memory: 64Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
        volumeMounts:
        - mountPath: /etc/qemu-scheduler
          name: scheduler-configs
          readOnly: true
      securityContext:
        runAsNonRoot: true
      serviceAccountName: cappx-controller-manager
      terminationGracePeriodSeconds: 10
      volumes:
      - configMap:
          name: cappx-qemu-scheduler-configs
        name: scheduler-configs
